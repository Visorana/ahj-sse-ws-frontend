!function(){"use strict";class e{constructor(e,t){this.server=t,this.parentElement=e,this.container=document.createElement("div"),this.container.classList.add("chat_login"),this.container.innerHTML='\n    <form class="chat_login_form">\n      <h3>Enter your nickname</h3>\n      <div class="chat_login_container">\n        <input name="login" class="chat_login_input">\n      </div>\n      <button>Join</button>\n    </form>',this.parentElement.append(this.container),this.form=this.parentElement.querySelector(".chat_login_form"),this.nickElement=this.parentElement.querySelector(".chat_login_input"),this.login=this.login.bind(this),this.showError=this.showError.bind(this),this.removeError=this.removeError.bind(this)}connect(){this.form.addEventListener("submit",this.login)}login(e){e.preventDefault(),""!==this.nickElement.value.trim()?(this.ws=new WebSocket(this.server),this.ws.addEventListener("open",(()=>{this.ws.send(JSON.stringify({event:"login",message:this.nickElement.value}))})),this.ws.addEventListener("message",(e=>{const t=JSON.parse(e.data);"connect"===t.event&&(this.clientsList=t.message,this.parentElement.dispatchEvent(new Event("connect")))})),this.ws.addEventListener("close",this.showError),this.ws.addEventListener("error",(e=>{console.error(e)}))):this.showError({reason:"Please enter your nickname"})}showError(e){const t=document.createElement("div");t.classList.add("chat_login_error"),t.innerText=e.reason,this.parentElement.querySelector(".chat_login_container").append(t),t.style.left=this.nickElement.offsetLeft+this.nickElement.offsetWidth/2-t.offsetWidth/2+"px",t.style.top=`${this.nickElement.offsetTop+this.nickElement.offsetHeight}px`,this.nickElement.addEventListener("focus",this.removeError)}removeError(){this.nickElement.value="";const e=this.parentElement.querySelector(".chat_login_error");e&&e.remove()}closeForm(){this.container.remove()}}new class{constructor(t,s){this.server=s,this.parentElement=t,this.chatContainer=this.parentElement.querySelector(".chat_main"),this.chatElement=this.parentElement.querySelector(".chat_messages"),this.chatMembersElement=this.parentElement.querySelector(".chat_members_list"),this.chatFormElement=this.parentElement.querySelector(".chat_form"),this.chatInputElement=this.parentElement.querySelector(".chat_input"),this.login=new e(this.parentElement,this.server),this.chat=this.chat.bind(this),this.sendMessage=this.sendMessage.bind(this)}init(){this.login.connect(),this.parentElement.addEventListener("connect",(()=>{this.chatContainer.style.display="flex",this.chat()}))}chat(){this.nickname=this.login.nickElement.value,this.allClients=this.login.clientsList,this.chatMembersReload(),this.login.closeForm(),this.login.ws.addEventListener("message",(e=>{const t=JSON.parse(e.data);if("chat"===t.event){const e=this.messageConstructor(t.message.nickname,t.message.date,t.message.text);this.chatElement.append(e),this.chatElement.scrollTop=this.chatElement.scrollHeight-this.chatElement.getBoundingClientRect().height}"system"===t.event&&this.systemMessageShow(t)})),this.chatFormElement.addEventListener("submit",this.sendMessage)}messageConstructor(e,t,s){const n=document.createElement("div");n.classList.add("chat_message"),this.nickname===e&&(n.classList.add("chat_message_you"),e="You");const i=document.createElement("div");i.classList.add("chat_message_info"),i.innerText=`${e}, ${new Date(t).toLocaleTimeString()} ${new Date(t).toLocaleDateString()}`;const a=document.createElement("div");return a.classList.add("chat_message_text"),a.innerText=s,n.append(i,a),n}chatMembersReload(){this.chatMembersElement.innerHTML="",this.allClients.forEach((e=>{const t=document.createElement("li");t.classList.add("chat_member"),t.innerText=e,this.chatMembersElement.append(t)}));const e=document.createElement("li");e.classList.add("chat_member"),e.classList.add("chat_member_you"),e.innerText="You",this.chatMembersElement.append(e)}sendMessage(e){e.preventDefault();const t=JSON.stringify({event:"chat",message:this.chatInputElement.value});this.login.ws.send(t),this.chatInputElement.value=""}systemMessageShow(e){const t=document.createElement("div");if(t.classList.add("chat_system_message"),"login"===e.message.action)t.innerText=`${e.message.nickname} joined the chat`,this.nickname!==e.message.nickname&&this.allClients.push(e.message.nickname);else if("logout"===e.message.action){t.innerText=`${e.message.nickname} leaved the chat`;const s=this.allClients.indexOf(e.message.nickname);this.allClients.splice(s,1)}this.chatElement.append(t),this.chatElement.scrollTop=this.chatElement.scrollHeight-this.chatElement.getBoundingClientRect().height,this.chatMembersReload()}}(document.querySelector(".chat"),"wss://ahj-sse-ws-backend-c784.onrender.com/").init()}();